<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whiley Recipes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="cookbook-wrapper">
        <header class="cookbook-header">
            <div class="ornamental-border">
                <h1>Whiley Recipes</h1>
                <p class="subtitle">Family Eaten Recipes Since 1963</p>
                <div class="decorative-line"></div>
            </div>
        </header>

        <!-- Mobile Search and Categories Section -->
        <div class="mobile-search-section">
            <div class="ornamental-border">
                <div class="mobile-search-container">
                    <div class="mobile-search-row">
                        <input type="text" id="mobile-search-input" placeholder="Search recipes..." class="mobile-search-input">
                        <button id="mobile-clear-search" class="mobile-clear-search">×</button>
                    </div>
                    <select id="mobile-category-select" class="mobile-category-select">
                        <option value="all">All Recipes</option>
                        <option value="mains">Main Courses</option>
                        <option value="desserts">Desserts</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Desktop Navigation -->
        <nav class="recipe-tabs desktop-nav">
            <div class="search-and-filter-container">
                <input type="text" id="search-input" placeholder="Search recipes by name, ingredient, or tag..." class="search-input">
                <select id="category-select" class="category-select">
                    <option value="all">All Recipes</option>
                    <option value="mains">Main Courses</option>
                    <option value="desserts">Desserts</option>
                </select>
                <button id="clear-search" class="clear-search">×</button>
            </div>
        </nav>

        <main class="recipe-grid" id="recipe-container">
            <!-- Recipes will be loaded dynamically from recipes.json -->
        </main>

        <footer class="cookbook-footer">
            <div class="ornamental-border">
                <p>Tastes different when Grandma does it</p>
                <div class="decorative-line"></div>
            </div>
        </footer>
    </div>

    <script>
        // Load recipes from JSON file
        async function loadRecipes() {
            try {
                const response = await fetch('./recipes.json');
                const data = await response.json();
                const container = document.getElementById('recipe-container');

                container.innerHTML = data.recipes.map(recipe => `
                    <article class="recipe-card" data-category="${recipe.category}" data-tags="${recipe.tags ? recipe.tags.join(',') : ''}" data-ingredients="${recipe.ingredients.join(',').toLowerCase()}" data-title="${recipe.title.toLowerCase()}">
                        <div class="card-inner">
                            <!-- Front of card -->
                            <div class="card-front">
                                <div class="front-image">
                                    <img src="${recipe.image}" alt="${recipe.title}" loading="lazy">
                                </div>
                                <div class="front-content">
                                    <div class="front-header">
                                        <h3>${recipe.title}</h3>
                                        ${recipe.tags ? `<div class="recipe-tags">
                                            ${recipe.tags.map(tag => `<span class="tag-pill">${tag}</span>`).join('')}
                                        </div>` : ''}
                                    </div>
                                    <div class="front-footer">
                                        <span class="prep-time">${recipe.prepTime}</span>
                                        <span class="serves">${recipe.serves}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Back of card -->
                            <div class="card-back">
                                <div class="back-header">
                                    <h3>${recipe.title}</h3>
                                    <button class="flip-back-btn">← Back</button>
                                </div>
                                <div class="recipe-content">
                                    <div class="recipe-main">
                                        <div class="ingredients">
                                            <h4>Ingredients:</h4>
                                            <div class="checklist">
                                                ${recipe.ingredients.map((ingredient, index) => `
                                                    <div class="checklist-item">
                                                        <input type="checkbox" id="ingredient-${recipe.id}-${index}" class="ingredient-checkbox">
                                                        <label for="ingredient-${recipe.id}-${index}">${ingredient}</label>
                                                    </div>
                                                `).join('')}
                                            </div>
                                            ${recipe.tags ? `<div class="recipe-tags">
                                                ${recipe.tags.map(tag => `<span class="tag-pill">${tag}</span>`).join('')}
                                            </div>` : ''}
                                        </div>
                                        <div class="nutrition-section" data-recipe-id="${recipe.id}">
                                            <button class="nutrition-toggle-btn" onclick="toggleNutrition(this)">
                                                View Nutrition Information <span class="toggle-arrow">▼</span>
                                            </button>
                                            <div class="nutrition-info">
                                        <div class="nutrition-header">
                                            <h4 class="nutrition-title">Nutrition Per Serving</h4>
                                            <div class="nutrition-buttons">
                                                <button class="mobile-hide-btn" onclick="hideMobileNutrition(this)" title="Hide nutrition info">×</button>
                                                <button class="nutrition-toggle" title="Click to toggle between per serving and total recipe">
                                                    <span class="toggle-icon">⇄</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="serving-size">
                                            <span class="serving-label">Serving Size:</span>
                                            <span class="serving-value" data-per-serving="${recipe.servingSize}" data-total="Total Recipe">${recipe.servingSize}</span>
                                        </div>
                                        <div class="nutrition-item">
                                            <span class="nutrition-label">Calories</span>
                                            <span class="nutrition-value" data-per-serving="${recipe.nutrition.calories}" data-total="${recipe.nutrition.calories * 12}">${recipe.nutrition.calories}</span>
                                        </div>
                                        <div class="nutrition-item">
                                            <span class="nutrition-label">Protein</span>
                                            <span class="nutrition-value" data-per-serving="${recipe.nutrition.protein}" data-total="${Math.round(parseFloat(recipe.nutrition.protein) * 12)}g">${recipe.nutrition.protein}</span>
                                        </div>
                                        <div class="nutrition-item">
                                            <span class="nutrition-label">Carbs</span>
                                            <span class="nutrition-value" data-per-serving="${recipe.nutrition.carbs}" data-total="${Math.round(parseFloat(recipe.nutrition.carbs) * 12)}g">${recipe.nutrition.carbs}</span>
                                        </div>
                                        <div class="nutrition-item">
                                            <span class="nutrition-label">Fat</span>
                                            <span class="nutrition-value" data-per-serving="${recipe.nutrition.fat}" data-total="${Math.round(parseFloat(recipe.nutrition.fat) * 12)}g">${recipe.nutrition.fat}</span>
                                        </div>
                                        <div class="nutrition-item">
                                            <span class="nutrition-label">Sugar</span>
                                            <span class="nutrition-value" data-per-serving="${recipe.nutrition.sugar}" data-total="${Math.round(parseFloat(recipe.nutrition.sugar) * 12)}g">${recipe.nutrition.sugar}</span>
                                        </div>
                                        <div class="nutrition-item">
                                            <span class="nutrition-label">Fiber</span>
                                            <span class="nutrition-value" data-per-serving="${recipe.nutrition.fiber}" data-total="${Math.round(parseFloat(recipe.nutrition.fiber) * 12)}g">${recipe.nutrition.fiber}</span>
                                        </div>
                                        </div>
                                    </div>
                                    <div class="instructions">
                                            <h4>Instructions:</h4>
                                            <div class="instruction-steps">
                                                ${recipe.instructions.map((instruction, index) => `
                                                    <div class="step-item">
                                                        <div class="step-content">
                                                            <span class="step-number">${instruction.step}.</span>
                                                            <span class="step-text">${instruction.text}</span>
                                                        </div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </article>
                `).join('');

                // Initialize functionality after recipes are loaded
                initializeCategorySelects();
                initializeCardFlips();
                initializeNutritionToggle();
                initializeSearch();
                initializeMobileSearch();
            } catch (error) {
                console.error('Error loading recipes:', error);
                document.getElementById('recipe-container').innerHTML = '<p>Error loading recipes.</p>';
            }
        }

        // Category select functionality
        function initializeCategorySelects() {
            const desktopSelect = document.getElementById('category-select');
            const mobileSelect = document.getElementById('mobile-category-select');
            const recipes = document.querySelectorAll('.recipe-card');

            function filterRecipes(category) {
                recipes.forEach(recipe => {
                    if (category === 'all' || recipe.dataset.category === category) {
                        recipe.style.display = 'block';
                    } else {
                        recipe.style.display = 'none';
                    }
                });
            }

            // Desktop category select
            desktopSelect.addEventListener('change', (e) => {
                const category = e.target.value;
                filterRecipes(category);
                // Sync with mobile select
                mobileSelect.value = category;
            });

            // Mobile category select
            mobileSelect.addEventListener('change', (e) => {
                const category = e.target.value;
                filterRecipes(category);
                // Sync with desktop select
                desktopSelect.value = category;
            });
        }

        // Card flip functionality
        function initializeCardFlips() {
            const cards = document.querySelectorAll('.recipe-card');

            cards.forEach(card => {
                const cardFront = card.querySelector('.card-front');
                const flipBackBtn = card.querySelector('.flip-back-btn');

                // Flip to back when clicking front
                cardFront.addEventListener('click', () => {
                    card.classList.add('flipped');
                });

                // Flip to front when clicking back button
                flipBackBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    card.classList.remove('flipped');
                });
            });
        }

        // Nutrition toggle functionality
        function initializeNutritionToggle() {
            const nutritionInfos = document.querySelectorAll('.nutrition-info');

            nutritionInfos.forEach(nutritionInfo => {
                const toggleBtn = nutritionInfo.querySelector('.nutrition-toggle');
                const nutritionValues = nutritionInfo.querySelectorAll('.nutrition-value');
                const servingValue = nutritionInfo.querySelector('.serving-value');
                let showingTotal = false;

                toggleBtn.addEventListener('click', () => {
                    showingTotal = !showingTotal;

                    if (showingTotal) {
                        nutritionInfo.classList.add('show-total');
                        nutritionValues.forEach(value => {
                            value.textContent = value.dataset.total;
                        });
                        if (servingValue) {
                            servingValue.textContent = servingValue.dataset.total;
                        }
                    } else {
                        nutritionInfo.classList.remove('show-total');
                        nutritionValues.forEach(value => {
                            value.textContent = value.dataset.perServing;
                        });
                        if (servingValue) {
                            servingValue.textContent = servingValue.dataset.perServing;
                        }
                    }
                });
            });
        }

        // Mobile nutrition toggle functionality
        function toggleMobileNutrition(button) {
            const nutritionInfo = button.nextElementSibling;
            const isVisible = nutritionInfo.classList.contains('mobile-visible');

            if (isVisible) {
                nutritionInfo.classList.remove('mobile-visible');
                button.textContent = 'Show Nutrition Info';
            } else {
                nutritionInfo.classList.add('mobile-visible');
                button.textContent = 'Hide Nutrition Info';
            }
        }

        // Nutrition toggle functionality
        function toggleNutrition(button) {
            const nutritionSection = button.closest('.nutrition-section');
            const isExpanded = nutritionSection.classList.contains('expanded');

            if (isExpanded) {
                nutritionSection.classList.remove('expanded');
                button.innerHTML = 'View Nutrition Information <span class="toggle-arrow">▼</span>';
            } else {
                nutritionSection.classList.add('expanded');
                button.innerHTML = 'Hide Nutrition Information <span class="toggle-arrow">▼</span>';
            }
        }

        // Hide mobile nutrition functionality (legacy - can be removed)
        function hideMobileNutrition(hideButton) {
            const nutritionInfo = hideButton.closest('.nutrition-info');
            const toggleButton = nutritionInfo.previousElementSibling;

            nutritionInfo.classList.remove('mobile-visible');
            toggleButton.textContent = 'Show Nutrition Info';
        }


        // Mobile Search functionality
        function initializeMobileSearch() {
            const mobileSearchInput = document.getElementById('mobile-search-input');
            const mobileClearButton = document.getElementById('mobile-clear-search');
            const recipes = document.querySelectorAll('.recipe-card');

            function performMobileSearch() {
                const searchTerm = mobileSearchInput.value.toLowerCase().trim();

                recipes.forEach(recipe => {
                    const title = recipe.dataset.title || '';
                    const ingredients = recipe.dataset.ingredients || '';
                    const tags = recipe.dataset.tags || '';

                    const matchesSearch = searchTerm === '' ||
                        title.includes(searchTerm) ||
                        ingredients.includes(searchTerm) ||
                        tags.toLowerCase().includes(searchTerm);

                    recipe.style.display = matchesSearch ? 'block' : 'none';
                });

                // Update clear button visibility
                mobileClearButton.style.display = searchTerm ? 'flex' : 'none';
            }

            mobileSearchInput.addEventListener('input', performMobileSearch);

            mobileClearButton.addEventListener('click', () => {
                mobileSearchInput.value = '';
                performMobileSearch();
                mobileSearchInput.focus();
            });
        }

        // Search functionality
        function initializeSearch() {
            const searchInput = document.getElementById('search-input');
            const clearButton = document.getElementById('clear-search');
            const recipes = document.querySelectorAll('.recipe-card');

            function performSearch() {
                const searchTerm = searchInput.value.toLowerCase().trim();

                recipes.forEach(recipe => {
                    const title = recipe.dataset.title || '';
                    const ingredients = recipe.dataset.ingredients || '';
                    const tags = recipe.dataset.tags || '';

                    const matchesSearch = searchTerm === '' ||
                        title.includes(searchTerm) ||
                        ingredients.includes(searchTerm) ||
                        tags.toLowerCase().includes(searchTerm);

                    recipe.style.display = matchesSearch ? 'block' : 'none';
                });

                // Update clear button visibility
                clearButton.style.display = searchTerm ? 'block' : 'none';
            }

            searchInput.addEventListener('input', performSearch);

            clearButton.addEventListener('click', () => {
                searchInput.value = '';
                performSearch();
                searchInput.focus();
            });
        }

        // Load recipes when page loads
        document.addEventListener('DOMContentLoaded', loadRecipes);
    </script>
</body>
</html>