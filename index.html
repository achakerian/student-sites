<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Sites</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="api.js"></script>
</head>
<body data-theme="dark">
  <header>
    <div class="brand">Student Sites</div>
    <nav class="navbar">
      <div class="search-container">
        <input type="text" id="search-input" placeholder="Search sites..." />
        <span class="search-icon">üîç</span>
      </div>
      <div class="nav-buttons">
        <button id="theme-toggle" aria-label="Toggle light/dark mode">‚òÄÔ∏è</button>
        <button id="index-btn" aria-label="View all sites">üìã</button>
      </div>
    </nav>
  </header>

  <main>
    <!-- Student Grid -->
    <section class="container">
      <ul class="grid" role="list" id="sites-grid">
        <!-- Sites will be loaded here -->
      </ul>

      <!-- Loading indicator -->
      <div id="loading-indicator" class="loading-indicator">
        <p>Loading student sites...</p>
      </div>
    </section>
  </main>

  <script>
    // Theme toggle functionality
    const themeToggle = document.getElementById("theme-toggle");
    const body = document.body;

    themeToggle.addEventListener("click", () => {
      const isDark = body.getAttribute("data-theme") === "dark";
      body.setAttribute("data-theme", isDark ? "light" : "dark");
      themeToggle.textContent = isDark ? "üåô" : "‚òÄÔ∏è";
    });

    // Index button functionality
    const indexBtn = document.getElementById("index-btn");
    indexBtn.addEventListener("click", () => {
      alert("Index of all websites - functionality to be implemented");
    });

    // Search functionality
    const searchInput = document.getElementById("search-input");
    searchInput.addEventListener("input", (e) => {
      const searchTerm = e.target.value.toLowerCase();
      const cards = document.querySelectorAll(".card");

      cards.forEach(card => {
        const title = card.querySelector("h3")?.textContent.toLowerCase() || "";
        const description = card.querySelector(".muted")?.textContent.toLowerCase() || "";

        if (title.includes(searchTerm) || description.includes(searchTerm)) {
          card.style.display = "block";
        } else {
          card.style.display = "none";
        }
      });
    });

    // Dynamic site loading
    async function loadStudentSites() {
      const sitesGrid = document.getElementById("sites-grid");
      const loadingIndicator = document.getElementById("loading-indicator");

      try {
        const api = new StudentSitesAPI();
        const sites = await api.loadSites();

        // Generate and append dynamic sites
        const dynamicSitesHTML = api.generateSiteGrid(sites);
        sitesGrid.insertAdjacentHTML('beforeend', dynamicSitesHTML);

        // Hide loading indicator
        loadingIndicator.style.display = 'none';

        console.log(`Loaded ${sites.length} student sites`);
      } catch (error) {
        console.error('Error loading student sites:', error);
        loadingIndicator.style.display = 'none';
      }
    }

    // Load sites when page loads
    document.addEventListener('DOMContentLoaded', loadStudentSites);
  </script>
</body>
</html>